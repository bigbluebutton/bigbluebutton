{"version":3,"file":"gearVRController.js","sourceRoot":"","sources":["../../../../sourceES6/core/Gamepads/Controllers/gearVRController.ts"],"names":[],"mappings":"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","sourcesContent":["import { Scene } from \"../../scene\";\r\nimport { Vector3 } from \"../../Maths/math.vector\";\r\nimport { AbstractMesh } from \"../../Meshes/abstractMesh\";\r\nimport { Mesh } from \"../../Meshes/mesh\";\r\nimport { SceneLoader } from \"../../Loading/sceneLoader\";\r\nimport { GamepadButtonChanges } from \"../../Gamepads/gamepad\";\r\nimport { WebVRController } from \"./webVRController\";\r\nimport { PoseEnabledControllerType, ExtendedGamepadButton, PoseEnabledControllerHelper } from \"./poseEnabledController\";\r\n\r\n/**\r\n     * Gear VR Controller\r\n     */\r\nexport class GearVRController extends WebVRController {\r\n    /**\r\n     * Base Url for the controller model.\r\n     */\r\n    public static MODEL_BASE_URL: string = 'https://controllers.babylonjs.com/generic/';\r\n    /**\r\n     * File name for the controller model.\r\n     */\r\n    public static MODEL_FILENAME: string = 'generic.babylon';\r\n\r\n    /**\r\n     * Gamepad Id prefix used to identify this controller.\r\n     */\r\n    public static readonly GAMEPAD_ID_PREFIX: string = 'Gear VR'; // id is 'Gear VR Controller'\r\n\r\n    private readonly _buttonIndexToObservableNameMap = [\r\n        'onPadStateChangedObservable', // Pad\r\n        'onTriggerStateChangedObservable' // Trigger\r\n    ];\r\n\r\n    /**\r\n     * Creates a new GearVRController from a gamepad\r\n     * @param vrGamepad the gamepad that the controller should be created from\r\n     */\r\n    constructor(vrGamepad: any) {\r\n        super(vrGamepad);\r\n        this.controllerType = PoseEnabledControllerType.GEAR_VR;\r\n        // Initial starting position defaults to where hand would be (incase of only 3dof controller)\r\n        this._calculatedPosition = new Vector3(this.hand == \"left\" ? -0.15 : 0.15, -0.5, 0.25);\r\n        this._disableTrackPosition(this._calculatedPosition);\r\n    }\r\n\r\n    /**\r\n     * Implements abstract method on WebVRController class, loading controller meshes and calling this.attachToMesh if successful.\r\n     * @param scene scene in which to add meshes\r\n     * @param meshLoaded optional callback function that will be called if the mesh loads successfully.\r\n     */\r\n    public initControllerMesh(scene: Scene, meshLoaded?: (mesh: AbstractMesh) => void) {\r\n        SceneLoader.ImportMesh(\"\", GearVRController.MODEL_BASE_URL, GearVRController.MODEL_FILENAME, scene, (newMeshes) => {\r\n            // Offset the controller so it will rotate around the users wrist\r\n            var mesh = new Mesh(\"\", scene);\r\n            newMeshes[1].parent = mesh;\r\n            newMeshes[1].position.z = -0.15;\r\n            this._defaultModel = mesh;\r\n            this.attachToMesh(this._defaultModel);\r\n            if (meshLoaded) {\r\n                meshLoaded(this._defaultModel);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Called once for each button that changed state since the last frame\r\n     * @param buttonIdx Which button index changed\r\n     * @param state New state of the button\r\n     * @param changes Which properties on the state changed since last frame\r\n     */\r\n    protected _handleButtonChange(buttonIdx: number, state: ExtendedGamepadButton, changes: GamepadButtonChanges) {\r\n        if (buttonIdx < this._buttonIndexToObservableNameMap.length) {\r\n            const observableName: string = this._buttonIndexToObservableNameMap[buttonIdx];\r\n\r\n            // Only emit events for buttons that we know how to map from index to observable\r\n            let observable = (<any>this)[observableName];\r\n            if (observable) {\r\n                observable.notifyObservers(state);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nPoseEnabledControllerHelper._ControllerFactories.push({\r\n    canCreate: (gamepadInfo) => {\r\n        return gamepadInfo.id.indexOf(GearVRController.GAMEPAD_ID_PREFIX) === 0 ||\r\n            gamepadInfo.id.indexOf('Oculus Go') !== -1 ||\r\n            gamepadInfo.id.indexOf('Vive Focus') !== -1;\r\n    },\r\n    create: (gamepadInfo) => {\r\n        return new GearVRController(gamepadInfo);\r\n    }\r\n});\r\n"]}