{"version":3,"file":"viveController.js","sourceRoot":"","sources":["../../../../sourceES6/core/Gamepads/Controllers/viveController.ts"],"names":[],"mappings":";AAEA,OAAO,EAAE,WAAW,EAAE,MAAM,2BAA2B,CAAC;AACxD,OAAO,EAAE,eAAe,EAAE,MAAM,mBAAmB,CAAC;AACpD,OAAO,EAAE,yBAAyB,EAAyB,2BAA2B,EAAE,MAAM,yBAAyB,CAAC;AAIxH;;GAEG;AACH;IAAoC,kCAAe;IAU/C;;;OAGG;IACH,wBAAY,SAAc;QAA1B,YACI,kBAAM,SAAS,CAAC,SAGnB;QAFG,KAAI,CAAC,cAAc,GAAG,yBAAyB,CAAC,IAAI,CAAC;QACrD,KAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC;;IAClC,CAAC;IAED;;;;OAIG;IACI,2CAAkB,GAAzB,UAA0B,KAAY,EAAE,UAAyC;QAAjF,iBAmBC;QAlBG,WAAW,CAAC,UAAU,CAAC,EAAE,EAAE,cAAc,CAAC,cAAc,EAAE,cAAc,CAAC,cAAc,EAAE,KAAK,EAAE,UAAC,SAAS;YACtG;;;;;;;;;;cAUE;YACF,KAAI,CAAC,aAAa,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;YAClC,KAAI,CAAC,YAAY,CAAC,KAAI,CAAC,aAAa,CAAC,CAAC;YACtC,IAAI,UAAU,EAAE;gBACZ,UAAU,CAAC,KAAI,CAAC,aAAa,CAAC,CAAC;aAClC;QACL,CAAC,CAAC,CAAC;IACP,CAAC;IAKD,sBAAW,8DAAkC;QAH7C;;WAEG;aACH;YACI,OAAO,IAAI,CAAC,kCAAkC,CAAC;QACnD,CAAC;;;OAAA;IAKD,sBAAW,+DAAmC;QAH9C;;WAEG;aACH;YACI,OAAO,IAAI,CAAC,kCAAkC,CAAC;QACnD,CAAC;;;OAAA;IAKD,sBAAW,8DAAkC;QAH7C;;WAEG;aACH;YACI,OAAO,IAAI,CAAC,uCAAuC,CAAC;QACxD,CAAC;;;OAAA;IAED;;;;;;;;;;OAUG;IACO,4CAAmB,GAA7B,UAA8B,SAAiB,EAAE,KAA4B,EAAE,OAA6B;QACxG,IAAI,YAAY,GAAG,KAAK,CAAC,CAAC,qCAAqC;QAC/D,QAAQ,SAAS,EAAE;YACf,KAAK,CAAC;gBACF,IAAI,CAAC,2BAA2B,CAAC,eAAe,CAAC,YAAY,CAAC,CAAC;gBAC/D,OAAO;YACX,KAAK,CAAC,EAAE,gBAAgB;gBACpB,IAAI,IAAI,CAAC,aAAa,EAAE;oBACL,CAAC,IAAI,CAAC,aAAa,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC,CAAE,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,YAAY,CAAC,KAAK,GAAG,IAAI,CAAC;iBACjG;gBACD,IAAI,CAAC,+BAA+B,CAAC,eAAe,CAAC,YAAY,CAAC,CAAC;gBACnE,OAAO;YACX,KAAK,CAAC,EAAG,wBAAwB;gBAC7B,IAAI,CAAC,kCAAkC,CAAC,eAAe,CAAC,YAAY,CAAC,CAAC;gBACtE,OAAO;YACX,KAAK,CAAC;gBACF,IAAI,IAAI,CAAC,aAAa,EAAE;oBACpB,IAAI,YAAY,CAAC,OAAO,EAAE;wBACP,CAAC,IAAI,CAAC,aAAa,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC,CAAE,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC;qBAC7E;yBACI;wBACc,CAAC,IAAI,CAAC,aAAa,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC,CAAE,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC;qBACxE;iBACJ;gBACD,IAAI,CAAC,uCAAuC,CAAC,eAAe,CAAC,YAAY,CAAC,CAAC;gBAC3E,OAAO;SACd;IACL,CAAC;IAxGD;;OAEG;IACW,6BAAc,GAAW,yCAAyC,CAAC;IACjF;;OAEG;IACW,6BAAc,GAAW,cAAc,CAAC;IAkG1D,qBAAC;CAAA,AA1GD,CAAoC,eAAe,GA0GlD;SA1GY,cAAc;AA4G3B,2BAA2B,CAAC,oBAAoB,CAAC,IAAI,CAAC;IAClD,SAAS,EAAE,UAAC,WAAW;QACnB,OAAO,WAAW,CAAC,EAAE,CAAC,WAAW,EAAE,CAAC,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC;IACjE,CAAC;IACD,MAAM,EAAE,UAAC,WAAW;QAChB,OAAO,IAAI,cAAc,CAAC,WAAW,CAAC,CAAC;IAC3C,CAAC;CACJ,CAAC,CAAC","sourcesContent":["import { Scene } from \"../../scene\";\r\nimport { AbstractMesh } from \"../../Meshes/abstractMesh\";\r\nimport { SceneLoader } from \"../../Loading/sceneLoader\";\r\nimport { WebVRController } from \"./webVRController\";\r\nimport { PoseEnabledControllerType, ExtendedGamepadButton, PoseEnabledControllerHelper } from \"./poseEnabledController\";\r\nimport { GamepadButtonChanges } from \"../../Gamepads/gamepad\";\r\nimport { Observable } from '../../Misc/observable';\r\n\r\n/**\r\n * Vive Controller\r\n */\r\nexport class ViveController extends WebVRController {\r\n    /**\r\n     * Base Url for the controller model.\r\n     */\r\n    public static MODEL_BASE_URL: string = 'https://controllers.babylonjs.com/vive/';\r\n    /**\r\n     * File name for the controller model.\r\n     */\r\n    public static MODEL_FILENAME: string = 'wand.babylon';\r\n\r\n    /**\r\n     * Creates a new ViveController from a gamepad\r\n     * @param vrGamepad the gamepad that the controller should be created from\r\n     */\r\n    constructor(vrGamepad: any) {\r\n        super(vrGamepad);\r\n        this.controllerType = PoseEnabledControllerType.VIVE;\r\n        this._invertLeftStickY = true;\r\n    }\r\n\r\n    /**\r\n     * Implements abstract method on WebVRController class, loading controller meshes and calling this.attachToMesh if successful.\r\n     * @param scene scene in which to add meshes\r\n     * @param meshLoaded optional callback function that will be called if the mesh loads successfully.\r\n     */\r\n    public initControllerMesh(scene: Scene, meshLoaded?: (mesh: AbstractMesh) => void) {\r\n        SceneLoader.ImportMesh(\"\", ViveController.MODEL_BASE_URL, ViveController.MODEL_FILENAME, scene, (newMeshes) => {\r\n            /*\r\n            Parent Mesh name: ViveWand\r\n            - body\r\n            - r_gripper\r\n            - l_gripper\r\n            - menu_button\r\n            - system_button\r\n            - trackpad\r\n            - trigger\r\n            - LED\r\n            */\r\n            this._defaultModel = newMeshes[1];\r\n            this.attachToMesh(this._defaultModel);\r\n            if (meshLoaded) {\r\n                meshLoaded(this._defaultModel);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Fired when the left button on this controller is modified\r\n     */\r\n    public get onLeftButtonStateChangedObservable(): Observable<ExtendedGamepadButton> {\r\n        return this.onMainButtonStateChangedObservable;\r\n    }\r\n\r\n    /**\r\n     * Fired when the right button on this controller is modified\r\n     */\r\n    public get onRightButtonStateChangedObservable(): Observable<ExtendedGamepadButton> {\r\n        return this.onMainButtonStateChangedObservable;\r\n    }\r\n\r\n    /**\r\n     * Fired when the menu button on this controller is modified\r\n     */\r\n    public get onMenuButtonStateChangedObservable(): Observable<ExtendedGamepadButton> {\r\n        return this.onSecondaryButtonStateChangedObservable;\r\n    }\r\n\r\n    /**\r\n     * Called once for each button that changed state since the last frame\r\n     * Vive mapping:\r\n     * 0: touchpad\r\n     * 1: trigger\r\n     * 2: left AND right buttons\r\n     * 3: menu button\r\n     * @param buttonIdx Which button index changed\r\n     * @param state New state of the button\r\n     * @param changes Which properties on the state changed since last frame\r\n     */\r\n    protected _handleButtonChange(buttonIdx: number, state: ExtendedGamepadButton, changes: GamepadButtonChanges) {\r\n        let notifyObject = state; //{ state: state, changes: changes };\r\n        switch (buttonIdx) {\r\n            case 0:\r\n                this.onPadStateChangedObservable.notifyObservers(notifyObject);\r\n                return;\r\n            case 1: // index trigger\r\n                if (this._defaultModel) {\r\n                    (<AbstractMesh>(this._defaultModel.getChildren()[6])).rotation.x = -notifyObject.value * 0.15;\r\n                }\r\n                this.onTriggerStateChangedObservable.notifyObservers(notifyObject);\r\n                return;\r\n            case 2:  // left AND right button\r\n                this.onMainButtonStateChangedObservable.notifyObservers(notifyObject);\r\n                return;\r\n            case 3:\r\n                if (this._defaultModel) {\r\n                    if (notifyObject.pressed) {\r\n                        (<AbstractMesh>(this._defaultModel.getChildren()[2])).position.y = -0.001;\r\n                    }\r\n                    else {\r\n                        (<AbstractMesh>(this._defaultModel.getChildren()[2])).position.y = 0;\r\n                    }\r\n                }\r\n                this.onSecondaryButtonStateChangedObservable.notifyObservers(notifyObject);\r\n                return;\r\n        }\r\n    }\r\n}\r\n\r\nPoseEnabledControllerHelper._ControllerFactories.push({\r\n    canCreate: (gamepadInfo) => {\r\n        return gamepadInfo.id.toLowerCase().indexOf('openvr') !== -1;\r\n    },\r\n    create: (gamepadInfo) => {\r\n        return new ViveController(gamepadInfo);\r\n    }\r\n});"]}