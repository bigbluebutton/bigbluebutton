{"version":3,"file":"sceneComponent.js","sourceRoot":"","sources":["../../sourceES6/core/sceneComponent.ts"],"names":[],"mappings":"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","sourcesContent":["import { Scene } from \"./scene\";\r\nimport { AbstractMesh } from \"./Meshes/abstractMesh\";\r\nimport { SubMesh, } from \"./Meshes/subMesh\";\r\nimport { _InstancesBatch } from \"./Meshes/mesh\";\r\nimport { SmartArrayNoDuplicate } from \"./Misc/smartArray\";\r\nimport { Nullable } from \"./types\";\r\nimport { Camera } from \"./Cameras/camera\";\r\nimport { RenderTargetTexture } from \"./Materials/Textures/renderTargetTexture\";\r\nimport { PickingInfo } from \"./Collisions/pickingInfo\";\r\nimport { AbstractScene } from \"./abstractScene\";\r\n\r\ndeclare type Mesh = import(\"./Meshes/mesh\").Mesh;\r\n\r\n/**\r\n * Groups all the scene component constants in one place to ease maintenance.\r\n * @hidden\r\n */\r\nexport class SceneComponentConstants {\r\n    public static readonly NAME_EFFECTLAYER = \"EffectLayer\";\r\n    public static readonly NAME_LAYER = \"Layer\";\r\n    public static readonly NAME_LENSFLARESYSTEM = \"LensFlareSystem\";\r\n    public static readonly NAME_BOUNDINGBOXRENDERER = \"BoundingBoxRenderer\";\r\n    public static readonly NAME_PARTICLESYSTEM = \"ParticleSystem\";\r\n    public static readonly NAME_GAMEPAD = \"Gamepad\";\r\n    public static readonly NAME_SIMPLIFICATIONQUEUE = \"SimplificationQueue\";\r\n    public static readonly NAME_GEOMETRYBUFFERRENDERER = \"GeometryBufferRenderer\";\r\n    public static readonly NAME_DEPTHRENDERER = \"DepthRenderer\";\r\n    public static readonly NAME_POSTPROCESSRENDERPIPELINEMANAGER = \"PostProcessRenderPipelineManager\";\r\n    public static readonly NAME_SPRITE = \"Sprite\";\r\n    public static readonly NAME_OUTLINERENDERER = \"Outline\";\r\n    public static readonly NAME_PROCEDURALTEXTURE = \"ProceduralTexture\";\r\n    public static readonly NAME_SHADOWGENERATOR = \"ShadowGenerator\";\r\n    public static readonly NAME_OCTREE = \"Octree\";\r\n    public static readonly NAME_PHYSICSENGINE = \"PhysicsEngine\";\r\n    public static readonly NAME_AUDIO = \"Audio\";\r\n\r\n    public static readonly STEP_ISREADYFORMESH_EFFECTLAYER = 0;\r\n\r\n    public static readonly STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER = 0;\r\n\r\n    public static readonly STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER = 0;\r\n\r\n    public static readonly STEP_ACTIVEMESH_BOUNDINGBOXRENDERER = 0;\r\n\r\n    public static readonly STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER = 1;\r\n\r\n    public static readonly STEP_BEFORECAMERADRAW_EFFECTLAYER = 0;\r\n    public static readonly STEP_BEFORECAMERADRAW_LAYER = 1;\r\n\r\n    public static readonly STEP_BEFORERENDERTARGETDRAW_LAYER = 0;\r\n\r\n    public static readonly STEP_BEFORERENDERINGMESH_OUTLINE = 0;\r\n\r\n    public static readonly STEP_AFTERRENDERINGMESH_OUTLINE = 0;\r\n\r\n    public static readonly STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW = 0;\r\n    public static readonly STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER = 1;\r\n\r\n    public static readonly STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE = 0;\r\n    public static readonly STEP_BEFORECAMERAUPDATE_GAMEPAD = 1;\r\n\r\n    public static readonly STEP_BEFORECLEAR_PROCEDURALTEXTURE = 0;\r\n\r\n    public static readonly STEP_AFTERRENDERTARGETDRAW_LAYER = 0;\r\n\r\n    public static readonly STEP_AFTERCAMERADRAW_EFFECTLAYER = 0;\r\n    public static readonly STEP_AFTERCAMERADRAW_LENSFLARESYSTEM = 1;\r\n    public static readonly STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW = 2;\r\n    public static readonly STEP_AFTERCAMERADRAW_LAYER = 3;\r\n\r\n    public static readonly STEP_AFTERRENDER_AUDIO = 0;\r\n\r\n    public static readonly STEP_GATHERRENDERTARGETS_DEPTHRENDERER = 0;\r\n    public static readonly STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER = 1;\r\n    public static readonly STEP_GATHERRENDERTARGETS_SHADOWGENERATOR = 2;\r\n    public static readonly STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER = 3;\r\n\r\n    public static readonly STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER = 0;\r\n\r\n    public static readonly STEP_POINTERMOVE_SPRITE = 0;\r\n    public static readonly STEP_POINTERDOWN_SPRITE = 0;\r\n    public static readonly STEP_POINTERUP_SPRITE = 0;\r\n}\r\n\r\n/**\r\n * This represents a scene component.\r\n *\r\n * This is used to decouple the dependency the scene is having on the different workloads like\r\n * layers, post processes...\r\n */\r\nexport interface ISceneComponent {\r\n    /**\r\n     * The name of the component. Each component must have a unique name.\r\n     */\r\n    name: string;\r\n\r\n    /**\r\n     * The scene the component belongs to.\r\n     */\r\n    scene: Scene;\r\n\r\n    /**\r\n     * Register the component to one instance of a scene.\r\n     */\r\n    register(): void;\r\n\r\n    /**\r\n     * Rebuilds the elements related to this component in case of\r\n     * context lost for instance.\r\n     */\r\n    rebuild(): void;\r\n\r\n    /**\r\n     * Disposes the component and the associated ressources.\r\n     */\r\n    dispose(): void;\r\n}\r\n\r\n/**\r\n * This represents a SERIALIZABLE scene component.\r\n *\r\n * This extends Scene Component to add Serialization methods on top.\r\n */\r\nexport interface ISceneSerializableComponent extends ISceneComponent {\r\n    /**\r\n     * Adds all the elements from the container to the scene\r\n     * @param container the container holding the elements\r\n     */\r\n    addFromContainer(container: AbstractScene): void;\r\n\r\n    /**\r\n     * Removes all the elements in the container from the scene\r\n     * @param container contains the elements to remove\r\n     * @param dispose if the removed element should be disposed (default: false)\r\n     */\r\n    removeFromContainer(container: AbstractScene, dispose?: boolean): void;\r\n\r\n    /**\r\n     * Serializes the component data to the specified json object\r\n     * @param serializationObject The object to serialize to\r\n     */\r\n    serialize(serializationObject: any): void;\r\n}\r\n\r\n/**\r\n * Strong typing of a Mesh related stage step action\r\n */\r\nexport type MeshStageAction = (mesh: AbstractMesh, hardwareInstancedRendering: boolean) => boolean;\r\n\r\n/**\r\n * Strong typing of a Evaluate Sub Mesh related stage step action\r\n */\r\nexport type EvaluateSubMeshStageAction = (mesh: AbstractMesh, subMesh: SubMesh) => void;\r\n\r\n/**\r\n * Strong typing of a Active Mesh related stage step action\r\n */\r\nexport type ActiveMeshStageAction = (sourceMesh: AbstractMesh, mesh: AbstractMesh) => void;\r\n\r\n/**\r\n * Strong typing of a Camera related stage step action\r\n */\r\nexport type CameraStageAction = (camera: Camera) => void;\r\n\r\n/**\r\n * Strong typing of a Camera Frame buffer related stage step action\r\n */\r\nexport type CameraStageFrameBufferAction = (camera: Camera) => boolean;\r\n\r\n/**\r\n * Strong typing of a Render Target related stage step action\r\n */\r\nexport type RenderTargetStageAction = (renderTarget: RenderTargetTexture) => void;\r\n\r\n/**\r\n * Strong typing of a RenderingGroup related stage step action\r\n */\r\nexport type RenderingGroupStageAction = (renderingGroupId: number) => void;\r\n\r\n/**\r\n * Strong typing of a Mesh Render related stage step action\r\n */\r\nexport type RenderingMeshStageAction = (mesh: Mesh, subMesh: SubMesh, batch: _InstancesBatch) => void;\r\n\r\n/**\r\n * Strong typing of a simple stage step action\r\n */\r\nexport type SimpleStageAction = () => void;\r\n\r\n/**\r\n * Strong typing of a render target action.\r\n */\r\nexport type RenderTargetsStageAction = (renderTargets: SmartArrayNoDuplicate<RenderTargetTexture>) => void;\r\n\r\n/**\r\n * Strong typing of a pointer move action.\r\n */\r\nexport type PointerMoveStageAction = (unTranslatedPointerX: number, unTranslatedPointerY: number, pickResult: Nullable<PickingInfo>, isMeshPicked: boolean, element: HTMLElement) => Nullable<PickingInfo>;\r\n\r\n/**\r\n * Strong typing of a pointer up/down action.\r\n */\r\nexport type PointerUpDownStageAction = (unTranslatedPointerX: number, unTranslatedPointerY: number, pickResult: Nullable<PickingInfo>, evt: PointerEvent) => Nullable<PickingInfo>;\r\n\r\n/**\r\n * Representation of a stage in the scene (Basically a list of ordered steps)\r\n * @hidden\r\n */\r\nexport class Stage<T extends Function> extends Array<{ index: number, component: ISceneComponent, action: T }> {\r\n    /**\r\n     * Hide ctor from the rest of the world.\r\n     * @param items The items to add.\r\n     */\r\n    private constructor(items?: { index: number, component: ISceneComponent, action: T }[]) {\r\n        super(...<any>items);\r\n    }\r\n\r\n    /**\r\n     * Creates a new Stage.\r\n     * @returns A new instance of a Stage\r\n     */\r\n    static Create<T extends Function>(): Stage<T> {\r\n        return Object.create(Stage.prototype);\r\n    }\r\n\r\n    /**\r\n     * Registers a step in an ordered way in the targeted stage.\r\n     * @param index Defines the position to register the step in\r\n     * @param component Defines the component attached to the step\r\n     * @param action Defines the action to launch during the step\r\n     */\r\n    public registerStep(index: number, component: ISceneComponent, action: T): void {\r\n        let i = 0;\r\n        let maxIndex = Number.MAX_VALUE;\r\n        for (; i < this.length; i++) {\r\n            let step = this[i];\r\n            maxIndex = step.index;\r\n            if (index < maxIndex) {\r\n                break;\r\n            }\r\n        }\r\n        this.splice(i, 0, { index, component, action: action.bind(component) });\r\n    }\r\n\r\n    /**\r\n     * Clears all the steps from the stage.\r\n     */\r\n    public clear(): void {\r\n        this.length = 0;\r\n    }\r\n}\r\n"]}