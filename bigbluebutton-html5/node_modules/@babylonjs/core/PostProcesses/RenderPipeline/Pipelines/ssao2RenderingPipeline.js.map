{"version":3,"file":"ssao2RenderingPipeline.js","sourceRoot":"","sources":["../../../../../sourceES6/core/PostProcesses/RenderPipeline/Pipelines/ssao2RenderingPipeline.ts"],"names":[],"mappings":"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","sourcesContent":["import { Logger } from \"../../../Misc/logger\";\r\nimport { serialize, SerializationHelper } from \"../../../Misc/decorators\";\r\nimport { Vector3, TmpVectors } from \"../../../Maths/math.vector\";\r\nimport { Camera } from \"../../../Cameras/camera\";\r\nimport { Effect } from \"../../../Materials/effect\";\r\nimport { Texture } from \"../../../Materials/Textures/texture\";\r\nimport { DynamicTexture } from \"../../../Materials/Textures/dynamicTexture\";\r\nimport { PostProcess } from \"../../../PostProcesses/postProcess\";\r\nimport { PostProcessRenderPipeline } from \"../../../PostProcesses/RenderPipeline/postProcessRenderPipeline\";\r\nimport { PostProcessRenderEffect } from \"../../../PostProcesses/RenderPipeline/postProcessRenderEffect\";\r\nimport { PassPostProcess } from \"../../../PostProcesses/passPostProcess\";\r\nimport { GeometryBufferRenderer } from \"../../../Rendering/geometryBufferRenderer\";\r\nimport { Scene } from \"../../../scene\";\r\nimport { _TypeStore } from '../../../Misc/typeStore';\r\nimport { EngineStore } from '../../../Engines/engineStore';\r\n\r\nimport \"../../../PostProcesses/RenderPipeline/postProcessRenderPipelineManagerSceneComponent\";\r\n\r\nimport \"../../../Shaders/ssao2.fragment\";\r\nimport \"../../../Shaders/ssaoCombine.fragment\";\r\n\r\n/**\r\n * Render pipeline to produce ssao effect\r\n */\r\nexport class SSAO2RenderingPipeline extends PostProcessRenderPipeline {\r\n    // Members\r\n\r\n    /**\r\n     * @ignore\r\n    * The PassPostProcess id in the pipeline that contains the original scene color\r\n    */\r\n    public SSAOOriginalSceneColorEffect: string = \"SSAOOriginalSceneColorEffect\";\r\n    /**\r\n     * @ignore\r\n    * The SSAO PostProcess id in the pipeline\r\n    */\r\n    public SSAORenderEffect: string = \"SSAORenderEffect\";\r\n    /**\r\n     * @ignore\r\n    * The horizontal blur PostProcess id in the pipeline\r\n    */\r\n    public SSAOBlurHRenderEffect: string = \"SSAOBlurHRenderEffect\";\r\n    /**\r\n     * @ignore\r\n    * The vertical blur PostProcess id in the pipeline\r\n    */\r\n    public SSAOBlurVRenderEffect: string = \"SSAOBlurVRenderEffect\";\r\n    /**\r\n     * @ignore\r\n    * The PostProcess id in the pipeline that combines the SSAO-Blur output with the original scene color (SSAOOriginalSceneColorEffect)\r\n    */\r\n    public SSAOCombineRenderEffect: string = \"SSAOCombineRenderEffect\";\r\n\r\n    /**\r\n    * The output strength of the SSAO post-process. Default value is 1.0.\r\n    */\r\n    @serialize()\r\n    public totalStrength: number = 1.0;\r\n\r\n    /**\r\n    * Maximum depth value to still render AO. A smooth falloff makes the dimming more natural, so there will be no abrupt shading change.\r\n    */\r\n    @serialize()\r\n    public maxZ: number = 100.0;\r\n\r\n    /**\r\n    * In order to save performances, SSAO radius is clamped on close geometry. This ratio changes by how much\r\n    */\r\n    @serialize()\r\n    public minZAspect: number = 0.2;\r\n\r\n    @serialize(\"samples\")\r\n    private _samples: number = 8;\r\n    /**\r\n    * Number of samples used for the SSAO calculations. Default value is 8\r\n    */\r\n    public set samples(n: number) {\r\n        this._ssaoPostProcess.updateEffect(\"#define SAMPLES \" + n + \"\\n#define SSAO\");\r\n        this._samples = n;\r\n        this._sampleSphere = this._generateHemisphere();\r\n    }\r\n    public get samples(): number {\r\n        return this._samples;\r\n    }\r\n\r\n    @serialize(\"textureSamples\")\r\n    private _textureSamples: number = 1;\r\n    /**\r\n    * Number of samples to use for antialiasing\r\n    */\r\n    public set textureSamples(n: number) {\r\n        this._textureSamples = n;\r\n\r\n        this._originalColorPostProcess.samples = n;\r\n        this._blurHPostProcess.samples = n;\r\n        this._blurVPostProcess.samples = n;\r\n        this._ssaoPostProcess.samples = n;\r\n        this._ssaoCombinePostProcess.samples = n;\r\n    }\r\n    public get textureSamples(): number {\r\n        return this._textureSamples;\r\n    }\r\n\r\n    /**\r\n     * Ratio object used for SSAO ratio and blur ratio\r\n     */\r\n    @serialize()\r\n    private _ratio: any;\r\n\r\n    /**\r\n    * Dynamically generated sphere sampler.\r\n    */\r\n    private _sampleSphere: number[];\r\n\r\n    /**\r\n    * Blur filter offsets\r\n    */\r\n    private _samplerOffsets: number[];\r\n\r\n    @serialize(\"expensiveBlur\")\r\n    private _expensiveBlur: boolean = true;\r\n    /**\r\n    * If bilateral blur should be used\r\n    */\r\n    public set expensiveBlur(b: boolean) {\r\n        this._blurHPostProcess.updateEffect(\"#define BILATERAL_BLUR\\n#define BILATERAL_BLUR_H\\n#define SAMPLES 16\\n#define EXPENSIVE \" + (b ? \"1\" : \"0\") + \"\\n\",\r\n            null, [\"textureSampler\", \"depthSampler\"]);\r\n        this._blurVPostProcess.updateEffect(\"#define BILATERAL_BLUR\\n#define SAMPLES 16\\n#define EXPENSIVE \" + (b ? \"1\" : \"0\") + \"\\n\",\r\n            null, [\"textureSampler\", \"depthSampler\"]);\r\n        this._expensiveBlur = b;\r\n    }\r\n\r\n    public get expensiveBlur(): boolean {\r\n        return this._expensiveBlur;\r\n    }\r\n\r\n    /**\r\n    * The radius around the analyzed pixel used by the SSAO post-process. Default value is 2.0\r\n    */\r\n    @serialize()\r\n    public radius: number = 2.0;\r\n\r\n    /**\r\n    * The base color of the SSAO post-process\r\n    * The final result is \"base + ssao\" between [0, 1]\r\n    */\r\n    @serialize()\r\n    public base: number = 0;\r\n\r\n    /**\r\n    *  Support test.\r\n    */\r\n    public static get IsSupported(): boolean {\r\n        var engine = EngineStore.LastCreatedEngine;\r\n        if (!engine) {\r\n            return false;\r\n        }\r\n        return engine.getCaps().drawBuffersExtension;\r\n    }\r\n\r\n    private _scene: Scene;\r\n    private _depthTexture: Texture;\r\n    private _normalTexture: Texture;\r\n    private _randomTexture: DynamicTexture;\r\n\r\n    private _originalColorPostProcess: PassPostProcess;\r\n    private _ssaoPostProcess: PostProcess;\r\n    private _blurHPostProcess: PostProcess;\r\n    private _blurVPostProcess: PostProcess;\r\n    private _ssaoCombinePostProcess: PostProcess;\r\n\r\n    /**\r\n     * Gets active scene\r\n     */\r\n    public get scene(): Scene {\r\n        return this._scene;\r\n    }\r\n\r\n    /**\r\n     * @constructor\r\n     * @param name The rendering pipeline name\r\n     * @param scene The scene linked to this pipeline\r\n     * @param ratio The size of the postprocesses. Can be a number shared between passes or an object for more precision: { ssaoRatio: 0.5, blurRatio: 1.0 }\r\n     * @param cameras The array of cameras that the rendering pipeline will be attached to\r\n     */\r\n    constructor(name: string, scene: Scene, ratio: any, cameras?: Camera[]) {\r\n        super(scene.getEngine(), name);\r\n\r\n        this._scene = scene;\r\n        this._ratio = ratio;\r\n\r\n        if (!this.isSupported) {\r\n            Logger.Error(\"SSAO 2 needs WebGL 2 support.\");\r\n            return;\r\n        }\r\n\r\n        var ssaoRatio = this._ratio.ssaoRatio || ratio;\r\n        var blurRatio = this._ratio.blurRatio || ratio;\r\n\r\n        // Set up assets\r\n        let geometryBufferRenderer = <GeometryBufferRenderer>scene.enableGeometryBufferRenderer();\r\n        this._createRandomTexture();\r\n        this._depthTexture = geometryBufferRenderer.getGBuffer().textures[0];\r\n        this._normalTexture = geometryBufferRenderer.getGBuffer().textures[1];\r\n\r\n        this._originalColorPostProcess = new PassPostProcess(\"SSAOOriginalSceneColor\", 1.0, null, Texture.BILINEAR_SAMPLINGMODE, scene.getEngine(), false);\r\n        this._originalColorPostProcess.samples = this.textureSamples;\r\n        this._createSSAOPostProcess(1.0);\r\n        this._createBlurPostProcess(ssaoRatio, blurRatio);\r\n        this._createSSAOCombinePostProcess(blurRatio);\r\n\r\n        // Set up pipeline\r\n        this.addEffect(new PostProcessRenderEffect(scene.getEngine(), this.SSAOOriginalSceneColorEffect, () => { return this._originalColorPostProcess; }, true));\r\n        this.addEffect(new PostProcessRenderEffect(scene.getEngine(), this.SSAORenderEffect, () => { return this._ssaoPostProcess; }, true));\r\n        this.addEffect(new PostProcessRenderEffect(scene.getEngine(), this.SSAOBlurHRenderEffect, () => { return this._blurHPostProcess; }, true));\r\n        this.addEffect(new PostProcessRenderEffect(scene.getEngine(), this.SSAOBlurVRenderEffect, () => { return this._blurVPostProcess; }, true));\r\n        this.addEffect(new PostProcessRenderEffect(scene.getEngine(), this.SSAOCombineRenderEffect, () => { return this._ssaoCombinePostProcess; }, true));\r\n\r\n        // Finish\r\n        scene.postProcessRenderPipelineManager.addPipeline(this);\r\n        if (cameras) {\r\n            scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(name, cameras);\r\n        }\r\n\r\n    }\r\n\r\n    // Public Methods\r\n\r\n    /**\r\n     * Get the class name\r\n     * @returns \"SSAO2RenderingPipeline\"\r\n     */\r\n    public getClassName(): string {\r\n        return \"SSAO2RenderingPipeline\";\r\n    }\r\n\r\n    /**\r\n     * Removes the internal pipeline assets and detatches the pipeline from the scene cameras\r\n     */\r\n    public dispose(disableGeometryBufferRenderer: boolean = false): void {\r\n        for (var i = 0; i < this._scene.cameras.length; i++) {\r\n            var camera = this._scene.cameras[i];\r\n\r\n            this._originalColorPostProcess.dispose(camera);\r\n            this._ssaoPostProcess.dispose(camera);\r\n            this._blurHPostProcess.dispose(camera);\r\n            this._blurVPostProcess.dispose(camera);\r\n            this._ssaoCombinePostProcess.dispose(camera);\r\n        }\r\n\r\n        this._randomTexture.dispose();\r\n\r\n        if (disableGeometryBufferRenderer) {\r\n            this._scene.disableGeometryBufferRenderer();\r\n        }\r\n\r\n        this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name, this._scene.cameras);\r\n\r\n        super.dispose();\r\n    }\r\n\r\n    // Private Methods\r\n    private _createBlurPostProcess(ssaoRatio: number, blurRatio: number): void {\r\n        this._samplerOffsets = [];\r\n        var expensive = this.expensiveBlur;\r\n\r\n        for (var i = -8; i < 8; i++) {\r\n            this._samplerOffsets.push(i * 2 + 0.5);\r\n        }\r\n\r\n        this._blurHPostProcess = new PostProcess(\"BlurH\", \"ssao2\", [\"outSize\", \"samplerOffsets\", \"near\", \"far\", \"radius\"], [\"depthSampler\"], ssaoRatio, null, Texture.TRILINEAR_SAMPLINGMODE, this._scene.getEngine(), false, \"#define BILATERAL_BLUR\\n#define BILATERAL_BLUR_H\\n#define SAMPLES 16\\n#define EXPENSIVE \" + (expensive ? \"1\" : \"0\") + \"\\n\");\r\n        this._blurHPostProcess.onApply = (effect: Effect) => {\r\n            if (!this._scene.activeCamera) {\r\n                return;\r\n            }\r\n\r\n            effect.setFloat(\"outSize\", this._ssaoCombinePostProcess.width > 0 ? this._ssaoCombinePostProcess.width : this._originalColorPostProcess.width);\r\n            effect.setFloat(\"near\", this._scene.activeCamera.minZ);\r\n            effect.setFloat(\"far\", this._scene.activeCamera.maxZ);\r\n            effect.setFloat(\"radius\", this.radius);\r\n            effect.setTexture(\"depthSampler\", this._depthTexture);\r\n            effect.setArray(\"samplerOffsets\", this._samplerOffsets);\r\n        };\r\n\r\n        this._blurVPostProcess = new PostProcess(\"BlurV\", \"ssao2\", [\"outSize\", \"samplerOffsets\", \"near\", \"far\", \"radius\"], [\"depthSampler\"], blurRatio, null, Texture.TRILINEAR_SAMPLINGMODE, this._scene.getEngine(), false, \"#define BILATERAL_BLUR\\n#define BILATERAL_BLUR_V\\n#define SAMPLES 16\\n#define EXPENSIVE \" + (expensive ? \"1\" : \"0\") + \"\\n\");\r\n        this._blurVPostProcess.onApply = (effect: Effect) => {\r\n            if (!this._scene.activeCamera) {\r\n                return;\r\n            }\r\n\r\n            effect.setFloat(\"outSize\", this._ssaoCombinePostProcess.height > 0 ? this._ssaoCombinePostProcess.height : this._originalColorPostProcess.height);\r\n            effect.setFloat(\"near\", this._scene.activeCamera.minZ);\r\n            effect.setFloat(\"far\", this._scene.activeCamera.maxZ);\r\n            effect.setFloat(\"radius\", this.radius);\r\n            effect.setTexture(\"depthSampler\", this._depthTexture);\r\n            effect.setArray(\"samplerOffsets\", this._samplerOffsets);\r\n\r\n        };\r\n\r\n        this._blurHPostProcess.samples = this.textureSamples;\r\n        this._blurVPostProcess.samples = this.textureSamples;\r\n    }\r\n\r\n    /** @hidden */\r\n    public _rebuild() {\r\n        super._rebuild();\r\n    }\r\n\r\n    private _bits = new Uint32Array(1);\r\n\r\n    //Van der Corput radical inverse\r\n    private _radicalInverse_VdC(i: number) {\r\n        this._bits[0] = i;\r\n        this._bits[0] = ((this._bits[0] << 16) | (this._bits[0] >> 16)) >>> 0;\r\n        this._bits[0] = ((this._bits[0] & 0x55555555) << 1) | ((this._bits[0] & 0xAAAAAAAA) >>> 1) >>> 0;\r\n        this._bits[0] = ((this._bits[0] & 0x33333333) << 2) | ((this._bits[0] & 0xCCCCCCCC) >>> 2) >>> 0;\r\n        this._bits[0] = ((this._bits[0] & 0x0F0F0F0F) << 4) | ((this._bits[0] & 0xF0F0F0F0) >>> 4) >>> 0;\r\n        this._bits[0] = ((this._bits[0] & 0x00FF00FF) << 8) | ((this._bits[0] & 0xFF00FF00) >>> 8) >>> 0;\r\n        return this._bits[0] * 2.3283064365386963e-10; // / 0x100000000 or / 4294967296\r\n    }\r\n\r\n    private _hammersley(i: number, n: number) {\r\n        return [i / n, this._radicalInverse_VdC(i)];\r\n    }\r\n\r\n    private _hemisphereSample_uniform(u: number, v: number): Vector3 {\r\n        var phi = v * 2.0 * Math.PI;\r\n        // rejecting samples that are close to tangent plane to avoid z-fighting artifacts\r\n        var cosTheta = 1.0 - (u * 0.85 + 0.15);\r\n        var sinTheta = Math.sqrt(1.0 - cosTheta * cosTheta);\r\n        return new Vector3(Math.cos(phi) * sinTheta, Math.sin(phi) * sinTheta, cosTheta);\r\n    }\r\n\r\n    private _generateHemisphere(): number[] {\r\n        var numSamples = this.samples;\r\n        var result = [];\r\n        var vector;\r\n\r\n        var i = 0;\r\n        while (i < numSamples) {\r\n            if (numSamples < 16) {\r\n                vector = this._hemisphereSample_uniform(Math.random(), Math.random());\r\n            } else {\r\n                var rand = this._hammersley(i, numSamples);\r\n                vector = this._hemisphereSample_uniform(rand[0], rand[1]);\r\n            }\r\n\r\n            result.push(vector.x, vector.y, vector.z);\r\n            i++;\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private _createSSAOPostProcess(ratio: number): void {\r\n        var numSamples = this.samples;\r\n\r\n        this._sampleSphere = this._generateHemisphere();\r\n\r\n        this._ssaoPostProcess = new PostProcess(\"ssao2\", \"ssao2\",\r\n            [\r\n                \"sampleSphere\", \"samplesFactor\", \"randTextureTiles\", \"totalStrength\", \"radius\",\r\n                \"base\", \"range\", \"projection\", \"near\", \"far\", \"texelSize\",\r\n                \"xViewport\", \"yViewport\", \"maxZ\", \"minZAspect\"\r\n            ],\r\n            [\"randomSampler\", \"normalSampler\"],\r\n            ratio, null, Texture.BILINEAR_SAMPLINGMODE,\r\n            this._scene.getEngine(), false,\r\n            \"#define SAMPLES \" + numSamples + \"\\n#define SSAO\");\r\n\r\n        this._ssaoPostProcess.onApply = (effect: Effect) => {\r\n            if (!this._scene.activeCamera) {\r\n                return;\r\n            }\r\n\r\n            effect.setArray3(\"sampleSphere\", this._sampleSphere);\r\n            effect.setFloat(\"randTextureTiles\", 32.0);\r\n            effect.setFloat(\"samplesFactor\", 1 / this.samples);\r\n            effect.setFloat(\"totalStrength\", this.totalStrength);\r\n            effect.setFloat2(\"texelSize\", 1 / this._ssaoPostProcess.width, 1 / this._ssaoPostProcess.height);\r\n            effect.setFloat(\"radius\", this.radius);\r\n            effect.setFloat(\"maxZ\", this.maxZ);\r\n            effect.setFloat(\"minZAspect\", this.minZAspect);\r\n            effect.setFloat(\"base\", this.base);\r\n            effect.setFloat(\"near\", this._scene.activeCamera.minZ);\r\n            effect.setFloat(\"far\", this._scene.activeCamera.maxZ);\r\n            effect.setFloat(\"xViewport\", Math.tan(this._scene.activeCamera.fov / 2) * this._scene.getEngine().getAspectRatio(this._scene.activeCamera, true));\r\n            effect.setFloat(\"yViewport\", Math.tan(this._scene.activeCamera.fov / 2));\r\n            effect.setMatrix(\"projection\", this._scene.getProjectionMatrix());\r\n\r\n            effect.setTexture(\"textureSampler\", this._depthTexture);\r\n            effect.setTexture(\"normalSampler\", this._normalTexture);\r\n            effect.setTexture(\"randomSampler\", this._randomTexture);\r\n        };\r\n        this._ssaoPostProcess.samples = this.textureSamples;\r\n    }\r\n\r\n    private _createSSAOCombinePostProcess(ratio: number): void {\r\n        this._ssaoCombinePostProcess = new PostProcess(\"ssaoCombine\", \"ssaoCombine\", [], [\"originalColor\", \"viewport\"],\r\n            ratio, null, Texture.BILINEAR_SAMPLINGMODE,\r\n            this._scene.getEngine(), false);\r\n\r\n        this._ssaoCombinePostProcess.onApply = (effect: Effect) => {\r\n            let viewport = this._scene.activeCamera!.viewport;\r\n            effect.setVector4(\"viewport\", TmpVectors.Vector4[0].copyFromFloats(viewport.x, viewport.y, viewport.width, viewport.height));\r\n            effect.setTextureFromPostProcess(\"originalColor\", this._originalColorPostProcess);\r\n        };\r\n        this._ssaoCombinePostProcess.samples = this.textureSamples;\r\n    }\r\n\r\n    private _createRandomTexture(): void {\r\n        var size = 128;\r\n\r\n        this._randomTexture = new DynamicTexture(\"SSAORandomTexture\", size, this._scene, false, Texture.TRILINEAR_SAMPLINGMODE);\r\n        this._randomTexture.wrapU = Texture.WRAP_ADDRESSMODE;\r\n        this._randomTexture.wrapV = Texture.WRAP_ADDRESSMODE;\r\n\r\n        var context = this._randomTexture.getContext();\r\n\r\n        var rand = (min: number, max: number) => {\r\n            return Math.random() * (max - min) + min;\r\n        };\r\n\r\n        var randVector = Vector3.Zero();\r\n\r\n        for (var x = 0; x < size; x++) {\r\n            for (var y = 0; y < size; y++) {\r\n                randVector.x = rand(0.0, 1.0);\r\n                randVector.y = rand(0.0, 1.0);\r\n                randVector.z = 0.0;\r\n\r\n                randVector.normalize();\r\n\r\n                randVector.scaleInPlace(255);\r\n                randVector.x = Math.floor(randVector.x);\r\n                randVector.y = Math.floor(randVector.y);\r\n\r\n                context.fillStyle = 'rgb(' + randVector.x + ', ' + randVector.y + ', ' + randVector.z + ')';\r\n                context.fillRect(x, y, 1, 1);\r\n            }\r\n        }\r\n\r\n        this._randomTexture.update(false);\r\n    }\r\n\r\n    /**\r\n     * Serialize the rendering pipeline (Used when exporting)\r\n     * @returns the serialized object\r\n     */\r\n    public serialize(): any {\r\n        var serializationObject = SerializationHelper.Serialize(this);\r\n        serializationObject.customType = \"SSAO2RenderingPipeline\";\r\n\r\n        return serializationObject;\r\n    }\r\n\r\n    /**\r\n     * Parse the serialized pipeline\r\n     * @param source Source pipeline.\r\n     * @param scene The scene to load the pipeline to.\r\n     * @param rootUrl The URL of the serialized pipeline.\r\n     * @returns An instantiated pipeline from the serialized object.\r\n     */\r\n    public static Parse(source: any, scene: Scene, rootUrl: string): SSAO2RenderingPipeline {\r\n        return SerializationHelper.Parse(() => new SSAO2RenderingPipeline(source._name, scene, source._ratio), source, scene, rootUrl);\r\n    }\r\n}\r\n\r\n_TypeStore.RegisteredTypes[\"BABYLON.SSAO2RenderingPipeline\"] = SSAO2RenderingPipeline;\r\n"]}