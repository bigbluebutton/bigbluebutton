usePlugin 'scala'
usePlugin 'java'
usePlugin 'war'

version = '0.71'

jar.enabled = true

archivesBaseName = 'bbb-deskshare-app' 

dependencies {	  
    providedCompile 'javax.servlet:servlet-api:2.5@jar'
	
	providedCompile 'mina:mina-core:2.0.4@jar' 
//	providedCompile 'org.apache.mina:mina-core:2.0.0-RC1@jar'
	
	// Spring
	compile 'org.springframework:spring-web:3.0.6.RELEASE@jar'
	compile  'org.springframework:spring-beans:3.0.6.RELEASE@jar'
	compile 'org.springframework:spring-context:3.0.6.RELEASE@jar'
	compile 'org.springframework:spring-core:3.0.6.RELEASE@jar'
	compile 'org.springframework:spring-webmvc:3.0.6.RELEASE@jar'
	
//    providedCompile 'spring:spring-web:3.0.0@jar'
//	providedCompile 'spring:spring-core:3.0.0@jar'
//   providedCompile 'spring:spring-aop:3.0.0@jar'
//	providedCompile 'spring:spring-beans:3.0.0@jar'
//	providedCompile 'spring:spring-context:3.0.0@jar'
	
//	providedCompile 'org/red5:red5:1.0rc1@jar'
	
	providedCompile 'org/red5:red5:1.0r4293@jar'
	
//    providedCompile ':log4j-over-slf4j:1.5.6@jar'
//	providedCompile ':logback-core:0.9.14@jar'
//	providedCompile ':logback-classic:0.9.14@jar'
//	providedCompile ':slf4j-api:1.5.6@jar'
	
	// Logging
	compile 'org.slf4j:com.springsource.slf4j.api:1.6.1@jar'
	compile 'org.slf4j:com.springsource.slf4j.bridge:1.6.1@jar'
	compile ':logback-core:0.9.28@jar'
	compile ':logback-classic:0.9.28@jar'
	compile ':log4j-over-slf4j:1.6.1@jar'
	compile ':jcl-over-slf4j:1.6.1@jar'
	compile ':jul-to-slf4j:1.6.1@jar'
	
	compile project(':common')
    compile 'commons-fileupload:commons-fileupload:1.2.1@jar'
	compile 'commons-io:commons-io:1.4@jar' 
//    compile 'spring:spring-webmvc:2.5.6@jar'
//	compile 'org.apache.mina:mina-integration-spring:1.1.7@jar'
    
    // Libraries needed to run the scala tools
    scalaTools 'org.scala-lang:scala-compiler:2.7.7'
    scalaTools 'org.scala-lang:scala-library:2.7.7'

    // Libraries needed for scala api
    compile 'org.scala-lang:scala-library:2.7.7'   
    compile 'net/lag/configgy:configgy:1.5@jar'
    
        // Testing
    compile 'org.testng:testng:5.8@jar' 
    compile 'org.easymock:easymock:2.4@jar'
    
        //redis
	compile 'redis.clients:jedis:1.5.1'
	compile 'commons-pool:commons-pool:1.5.5'
}

test {
	useTestNG() 
}

war.doLast {
  ant.unzip(src: war.archivePath, dest: "$buildDir/deskshare")
  ant.copy(file: "$buildDir/deskshare/WEB-INF/logback-deskshare.xml", todir: "$buildDir/deskshare/WEB-INF/classes")
}

task deploy() << {
	def red5AppsDir = '/usr/share/red5/webapps'
	def deskshareDir = new File("${red5AppsDir}/deskshare")
	println "Deleting $deskshareDir"
	ant.delete(dir: deskshareDir)
	ant.mkdir(dir: deskshareDir)
	ant.copy(todir: deskshareDir) {
    	fileset(dir: "$buildDir/deskshare")
    }
} 
